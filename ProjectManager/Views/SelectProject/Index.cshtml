@using ProjectManager.Models
@model IEnumerable<ProjectManager.Models.Grouped<string, Project>>
@{
    ViewBag.Title = "選擇專案";
}
@section style{
    <style>
        .ProjectFlex_a {
            display: flex;
            flex-wrap: wrap;
        }
        h4:hover {
            text-decoration: none;
            cursor: pointer;
        }

        .bookMark {
            position: relative;
            top: -6px;
            float: right;
            margin-right: 0.5rem !important;
        }

        .nav {
            justify-content: center;
        }

        .nav-fill .nav-item {
            flex:none;
            padding:10px 100px;
        }
        .topnav a {
            cursor: pointer;
        }

        .isActive {
            background-color: #dddfe2;
        }
        .rightOpenbtn {
            display:none;
        }

    </style>
}

<nav>
    <div class="topnav nav nav-tabs nav-fill " id="nav-tab" role="tablist">
        <a class="nav-item nav-link" id="selectProject" role="tab" aria-controls="nav-home" aria-selected="true">選擇專案</a>
        <a class="nav-item nav-link" id="allTasks" role="tab" aria-controls="nav-home" aria-selected="true">任務總覽</a>
    </div>
</nav>
<div id="PartialView" class="hide">
</div>
<div id="ProjectsOverview" class="ProjectFlex_a container mt-5">
    @{int i = 0; }
    @foreach (var g in Model)
    {
        <h4 class="text-dark my-4" style="font-size:20px;" data-Dept=Dept@(i)>
            <span class="float-left"><i class="fas fa-caret-down"></i></span>
            @g.Key
        </h4>

        <div class="collapsible my-4 container" id=Dept@(i)>
            @foreach (var item in g.group)
            {
                <a href='@Url.Action("Index", "SelectMBoard",new { id=item.ProjectGUID })' data-ProjectGUID="@item.ProjectGUID">
                    <div class="card d-inline-block mr-3 mb-2 mt-1" style="width:18rem;">
                        @{
                            if ((bool)item.IsGeneralManagerConcerned)
                            {
                                <span class="bookMark" data-toggle="tooltip" title="總經理關注"><img style="width:28px;" src="~/image/bookmark_icon30.png" /></span>
                            }
                        }
                        <div class="card-header text-center text-muted ">
                            <div class="row align-items-center mx-0">
                                <div class="col pl-3">
                                    <h6 class="mb-0">
                                        @Html.DisplayFor(m => item.ProjectName)
                                    </h6>

                                </div>

                            </div>
                        </div>

                        <div class="card-footer bg-dark pt-2 pb-3">
                            @*  *@
                            <span class="text-light">@Html.DisplayNameFor(m => m.group.FirstOrDefault().CompletedRate)</span>
                            <div class="progress">
                                @{
                                    string percent = string.Format("{0}%", item.CompletedRate);
                                    string value = item.CompletedRate.ToString();
                                }
                                <div class="progress-bar" role="progressbar" style="width: @percent;" aria-valuenow="@value" aria-valuemin="0" aria-valuemax="100">@percent</div>
                            </div>
                            <span class="text-light">@Html.DisplayNameFor(m => m.group.FirstOrDefault().DurationSavedRate)</span>
                            <div class="progress ">
                                <div class="progress-bar " role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                            </div>
                        </div>
                    </div>
                </a>
            }
        </div>
    }
</div>
@section script{
    <script>

        $(document).ready(function () {
            $('#nav-tab > a').first().addClass('isActive');

            $('#nav-tab > #allTasks').click(function () {
                var PartialView = $("#PartialView");
                PartialView.load("/SelectProject/AllTasks", {}, function () {
                }).show();
                $('.ProjectFlex_a').hide();
                $(this).addClass('isActive');
                $('#nav-tab > a').not(this).removeClass('isActive');

            })
            $('#nav-tab > #selectProject').click(function () {
                var PartialView = $("#PartialView");
                $('.ProjectFlex_a').show();
                PartialView.hide();
                $(this).addClass('isActive');
                $('#nav-tab > a').not(this).removeClass('isActive');
               
            })

            var Overview = $('#ProjectsOverview');
            Overview.find('h4').on("click", function () {
                var _dept = "#" + $(this).attr("data-Dept");
                $(_dept).toggle("blind", {}, 300);
                $(this).find("i").toggleClass("fas fa-caret-down").toggleClass("fas fa-caret-right");
            });
        })
    </script>
}